---
title: "The Effects of Air Quality on U.S. Life Expectancy"
author: "Michael T. Moen"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
  df_print: paged
---
\fontsize{11}{16.5}
\selectfont

```{r, echo=FALSE}
# Import Data
data <- read.csv("air_quality_mortality_trimmed.csv")
```

\newpage

\section{Abstract}

Write last once background, methodology, and results are all established.

\newpage

\section{Background}

Ground-level ozone and fine particulate matter are two of the most significant air pollutants that impact public health. This analysis explores this issue by looking at the relationship of these two pollutants with the life expectancy of U.S. counties due to various mortality factors.

\subsection{Data Sources}

The data used in this analysis was collected from two main sources. The mortality data comes from the Institute for Health Metrics and Evaluation (IHME) and contains data for various mortality factors, with the most recent data being from 2014. Since this data is derived from death registration data, it is not missing data for any counties.

The air quality data in this analysis was published by the Environment Protection Agency (EPA) and covers the presence of various pollutants recorded in the United States by county in 2023. Since this methodology only allows the EPA to monitor the pollutants in counties with the appropriate facilities to record such data, it is much more sparse. Only about one-third of counties have any recorded data, and the counties that do have recorded data typically only monitor select pollutants. However, the two pollutants that have the most significant impact on public health, ground-level ozone and fine particulate matter, are the most widely recorded pollutants. Because of this, these pollutants are the focus of this analysis.

\subsection{Ground-Level Ozone}

Ground-level ozone is a pollutant that has been shown to have negative effects on the health of individuals, particularly those with respiratory issues such as asthma.

```{r, echo=FALSE, results=FALSE}
categories <- unique(data$Category)
#categories
```

```{r, echo=FALSE, results=FALSE}
data_by_category <- split(data, categories)
respiratory_data <- data_by_category[["Chronic respiratory diseases"]]
str(respiratory_data)
```

```{r, warning=FALSE, echo=FALSE, results=FALSE}
ozone_by_county <- as.numeric(respiratory_data$O3.8.hr..ppm)
sum(is.na(ozone_by_county))
length(ozone_by_county)

ozone_by_county <- ozone_by_county[!is.na(ozone_by_county)]
length(ozone_by_county)
summary(ozone_by_county)
```

```{r, echo=FALSE, fig.height=4}
hist(ozone_by_county,
     main = "Ground-Level Ozone by U.S. County",
     #main = NULL,
     xlab = "Fourth Daily Maximum 8-Hour Ozone Concentration (ppm)",
     ylab = "Number of Counties")
abline(v = 0.07, col = "black", lwd = 4, lty = 2)
```

The histogram shows the severity of the ground-level ozone recorded by the EPA in 2023 for each county. Note that the EPA only recorded this data in 761 of the 3143 counties and county-equivalents (parishes in Louisiana, borroughs in Alaska, etc.) in the United States.

The EPA's National Ambient Air Quality Standards (NAAQS) sets the threshold for the ground-level ozone at 0.07 parts per million (ppm), which is represented by the vertical line in the histogram. The high number of counties above this threshold show that this pollutant has an unhealthy presence in many places in the United States.

\subsection{Fine Particulate Matter}

Fine particulate matter (PM2.5) refers to particles with a diameter of 2.5 micrometers or smaller. These fine particles can be made up of anything, with some of the notable sources of PM2.5 including vehicle emissions, industrial activity, and wildfires. Like ground-level ozone, fine particulate matter has been shown to have negative impact on health, particularly among those with pre-existing respiratory issues.

```{r, warning=FALSE, echo=FALSE, results=FALSE}
fpm_by_county <- as.numeric(respiratory_data$PM2.5.Wtd.AM..µg.m3)
sum(is.na(fpm_by_county))
length(fpm_by_county)

fpm_by_county <- fpm_by_county[!is.na(fpm_by_county)]
length(fpm_by_county)
summary(fpm_by_county)
```

```{r, echo=FALSE}
hist(fpm_by_county,
     main = "Fine Particulate Matter by U.S. County",
     #main = NULL,
     xlab = "PM2.5 Weighted Annual Mean Concentration (µg/m^3)",
     ylab = "Number of Counties")
abline(v = 9, col = "black", lwd = 4, lty = 2)
```

The histogram shows the severity of the fine particulate matter (PM2.5) recorded by the EPA in 2023 for each county. Note that the EPA only recorded this data in 562 of the 3143 counties and county-equivalents (parishes in Louisiana, borroughs in Alaska, etc.) in the United States.

The NAAQS sets the threshold for the fine particulate matter at 9.0 $\mu g/m^3$, which is represented by the vertical line in the histogram. The high number of counties above this threshold show that this pollutant has an unhealthy presence in many places in the United States.

\newpage

\section{Methodology}

\subsection{Data Preparation}

The two datasets used in this analysis were found online as CSV and XLSX files. These file were downloaded and joined using Python's pandas library using the the county FIPS codes (see Appendix A for details). This merged dataset was then imported into R for analysis.

Since the air quality data does not cover every U.S. county, only the cases that contain both 

\subsection{Predicting Mortality Due to Cardiovascular Factors from Air Quality}



\section{Results}



\section{Conclusion}

Summarize findings and explain importance (or lack thereof) of findings. Write once finished with other sections

\newpage

\section{Appendices}

\subsection{Apendix A: Merging Datasets with Python}

```{python, eval = FALSE, python.reticulate=FALSE}
import pandas as pd

# Read and clean mortality data
mortality_df = pd.read_csv('mort.csv')
mortality_df = mortality_df.dropna(subset=['FIPS'])
mortality_df['FIPS'] = mortality_df['FIPS'].astype(int)

# Read and clean air quality data
aqi_df = pd.read_excel('ctyfactbook2023.xlsx',
                       sheet_name='County Factbook 2023',
                       skiprows=2)
aqi_df = aqi_df.dropna(subset=['County FIPS Code'])
aqi_df['County FIPS Code'] = aqi_df['County FIPS Code'].astype(int)

# Join datasets on FIPS codes
merged_df = pd.merge(mortality_df, aqi_df,
                     left_on='FIPS', right_on='County FIPS Code', how='inner')

# Export merged dataframe to CSV
merged_df.to_csv('air_quality_mortality.csv', index=False)
```

The two datasets used in this analysis were joined using Python's pandas library. Note that some columns were dropped and renamed for ease of use, but this was omitted from this code block.




```{r, echo=FALSE}
# Filter rows with missing values
filtered_resp_data <- subset(respiratory_data, O3.8.hr..ppm. != "ND")
filtered_resp_data <- subset(filtered_resp_data, PM2.5.Wtd.AM..µg.m3. != "ND")
filtered_resp_data <- subset(filtered_resp_data, PM2.5.Wtd.AM..µg.m3. != "IN")
filtered_resp_data$O3.8.hr..ppm. <- as.numeric(filtered_resp_data$O3.8.hr..ppm.)
filtered_resp_data$PM2.5.Wtd.AM..µg.m3. <- as.numeric(filtered_resp_data$PM2.5.Wtd.AM..µg.m3.)
filtered_resp_data <- subset(filtered_resp_data, X2010.Population > 100000)

resp_linmodel <- lm(Mortality.Rate..2014. ~ O3.8.hr..ppm., data = filtered_resp_data)
summary(resp_linmodel)


# Define population threshold
population_threshold <- 200000

# Assign colors based on the population threshold
filtered_resp_data$color <- ifelse(
  filtered_resp_data$X2010.Population > population_threshold, 
  "red",   # Color for counties above the threshold
  "blue"   # Color for counties below or equal to the threshold
)

plot(filtered_resp_data$O3.8.hr..ppm.,
     filtered_resp_data$Mortality.Rate..2014.,
     col=filtered_resp_data$color,
     pch=19
)
abline(resp_linmodel)
```

```{r, echo=FALSE}
fpm_resp_model <- lm(Mortality.Rate..2014. ~ PM2.5.Wtd.AM..µg.m3.,
                     data = filtered_resp_data)
summary(fpm_resp_model)

# Define population threshold
population_threshold <- 100000

# Assign colors based on the population threshold
filtered_resp_data$color <- ifelse(
  filtered_resp_data$X2010.Population > population_threshold, 
  "red",   # Color for counties above the threshold
  "blue"   # Color for counties below or equal to the threshold
)

plot(filtered_resp_data$PM2.5.Wtd.AM..µg.m3.,
     filtered_resp_data$Mortality.Rate..2014.,
     col=filtered_resp_data$color,
     pch=19
)
abline(fpm_resp_model)
```

```{r, echo=FALSE}
pop_resp_model <- lm(Mortality.Rate..2014. ~ X2010.Population,
                     data = filtered_resp_data)
summary(pop_resp_model)

# Define population threshold
population_threshold <- 100000

# Assign colors based on the population threshold
filtered_resp_data$color <- ifelse(
  filtered_resp_data$X2010.Population > population_threshold, 
  "red",   # Color for counties above the threshold
  "blue"   # Color for counties below or equal to the threshold
)

plot(filtered_resp_data$X2010.Population,
     filtered_resp_data$Mortality.Rate..2014.,
     col=filtered_resp_data$color,
     pch=19
)
abline(pop_resp_model)
```

```{r, echo=FALSE}
resp_model <- lm(Mortality.Rate..2014. ~ O3.8.hr..ppm. +
                 PM2.5.Wtd.AM..µg.m3. + X2010.Population, data = filtered_resp_data)
summary(resp_model)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
